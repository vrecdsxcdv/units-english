# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Elastic Email HTTP API –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## üìù –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
**–ú–µ—Ç–æ–¥:** Elastic Email HTTP API v2 (–ù–ï SMTP)

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –û—Ç–ø—Ä–∞–≤–∫–∞ email —á–µ—Ä–µ–∑ HTTP API
- ‚ùå –£–¥–∞–ª–µ–Ω: nodemailer, SMTP
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: –ß–∏—Å—Ç—ã–π HTTP API –∑–∞–ø—Ä–æ—Å –∫ Elastic Email
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: API Key –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ API

### 2. –¢–æ–∫–µ–Ω—ã –≤–º–µ—Å—Ç–æ –∫–æ–¥–æ–≤
- ‚ùå –ë—ã–ª–æ: 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≤—Ä—É—á–Ω—É—é)
- ‚úÖ –°—Ç–∞–ª–æ: –¢–æ–∫–µ–Ω –≤ —Å—Å—ã–ª–∫–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞–µ—Ç)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è: `crypto.randomBytes(32)` (64 hex —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ TTL: 15 –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ GET –∑–∞–ø—Ä–æ—Å: `/api/auth/verify-email?token=xxx`
- ‚úÖ POST –∑–∞–ø—Ä–æ—Å: `/api/auth/verify-email { token }`
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ UX: Loading ‚Üí Success/Error ‚Üí Redirect to /login

### 4. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–ø–∞–º)
- ‚úÖ HTML + Plain text –≤–µ—Ä—Å–∏–∏ –ø–∏—Å–µ–º

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| [src/lib/email-elastic.ts](src/lib/email-elastic.ts) | –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email —á–µ—Ä–µ–∑ Elastic Email HTTP API |
| [ELASTIC_EMAIL_SETUP.md](ELASTIC_EMAIL_SETUP.md) | –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |
| [ELASTIC_EMAIL_QUICKSTART.md](ELASTIC_EMAIL_QUICKSTART.md) | –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ |
| [ELASTIC_EMAIL_READY.md](ELASTIC_EMAIL_READY.md) | –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ |
| [test-elastic-verification.ts](test-elastic-verification.ts) | –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ |

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ |
|------|--------------|
| [src/app/api/register/route.ts](src/app/api/register/route.ts) | –ò–º–ø–æ—Ä—Ç `email-elastic`, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (32 –±–∞–π—Ç–∞), TTL 15 –º–∏–Ω—É—Ç |
| [src/app/api/auth/verify-email/route.ts](src/app/api/auth/verify-email/route.ts) | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GET/POST, —Ç–æ–∫–µ–Ω –≤–º–µ—Å—Ç–æ –∫–æ–¥–∞ |
| [src/app/verify-email/page.tsx](src/app/verify-email/page.tsx) | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ URL, –∞–≤—Ç–æ–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è |
| [.env.local](.env.local) | –î–æ–±–∞–≤–ª–µ–Ω—ã `ELASTIC_EMAIL_API_KEY` –∏ `ELASTIC_EMAIL_FROM` |

---

## ‚öôÔ∏è –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
ELASTIC_EMAIL_API_KEY=D518BF93DBB2DD5A0157D891557719B8DDEFD6626AA3C15A7D4F7260A75217446CD248DCD4B0F3D85F9B90495707A382
ELASTIC_EMAIL_FROM=lifematvej9@gmail.com

# URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
NEXTAUTH_URL=http://localhost:3000
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ

```bash
npx tsx test-elastic-verification.ts

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –¢–ï–°–¢ –ü–†–û–ô–î–ï–ù: Email —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!
Transaction ID: d01b0b71-391a-c15d-a071-6d7a40e16051
Message ID: OfzjUTSMzT4N6EjcLk8x-Q2
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

1. **–û—Ç–∫—Ä—ã—Ç—å:** http://localhost:3000/register
2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è** —Å –≤–∞—à–∏–º email
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** –ø–æ—á—Ç—É (–≤–æ–∑–º–æ–∂–Ω–æ –≤ —Å–ø–∞–º–µ)
4. **–ö–ª–∏–∫–Ω—É—Ç—å** –Ω–∞ —Å—Å—ã–ª–∫—É –≤ –ø–∏—Å—å–º–µ
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Üí Redirect –Ω–∞ /login

---

## üìß –§–æ—Ä–º–∞—Ç –ø–∏—Å—å–º–∞

### –¢–µ–º–∞
```
Confirm your email
```

### –ö–Ω–æ–ø–∫–∞ –≤ –ø–∏—Å—å–º–µ
```
[Confirm Email] ‚Üí http://localhost:3000/verify-email?token=TOKEN
```

### TTL —Å—Å—ã–ª–∫–∏
```
15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| –≠–ª–µ–º–µ–Ω—Ç | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|---------|------------|--------|
| API Key | –í –∑–∞–≥–æ–ª–æ–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ (–Ω–µ –≤ URL) | ‚úÖ |
| –¢–æ–∫–µ–Ω | `crypto.randomBytes(32)` | ‚úÖ |
| TTL | 15 –º–∏–Ω—É—Ç, –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö | ‚úÖ |
| –ü–∞—Ä–æ–ª–∏ | bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ |
| Email —Ç–∏–ø | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π (`isTransactional: true`) | ‚úÖ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ | ‚úÖ |

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### 1. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω –≤ Elastic Email
–≠—Ç–æ —É–ª—É—á—à–∏—Ç –¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ—Å—Ç—å –∏ –ø–æ–∑–≤–æ–ª–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π email:

```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ Elastic Email Dashboard:
Settings ‚Üí Domains ‚Üí Add Domain: unitsenglish.com

# –î–æ–±–∞–≤—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏:
- SPF: v=spf1 include:_spf.elasticemail.com ~all
- DKIM: [–ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç Elastic Email]
- DMARC: v=DMARC1; p=none
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è production

```bash
# .env.production (–∏–ª–∏ –≤ –ø–∞–Ω–µ–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥–∞)
ELASTIC_EMAIL_API_KEY=–í–ê–®_API_KEY
ELASTIC_EMAIL_FROM=no-reply@unitsenglish.com
NEXTAUTH_URL=https://unitsenglish.com
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∏—Å–µ–º –Ω–∞ –æ–¥–∏–Ω email:
- –ù–∞–ø—Ä–∏–º–µ—Ä: –º–∞–∫—Å–∏–º—É–º 3 –ø–∏—Å—å–º–∞ –≤ —á–∞—Å
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

---

## üìä HTTP API –∑–∞–ø—Ä–æ—Å (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)

```http
POST https://api.elasticemail.com/v2/email/send
Content-Type: application/x-www-form-urlencoded

apikey=YOUR_API_KEY
&from=lifematvej9@gmail.com
&fromName=Units English
&to=user@example.com
&subject=Confirm your email
&bodyHtml=<html>...</html>
&bodyText=Plain text version
&isTransactional=true
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "transactionid": "d01b0b71-391a-c15d-a071-6d7a40e16051",
    "messageid": "OfzjUTSMzT4N6EjcLk8x-Q2"
  }
}
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ dev —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Elastic Email Dashboard ‚Üí Email Log
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã (–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º" –≤ –ø–æ—á—Ç–µ

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [x] Elastic Email HTTP API –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
- [x] –¢–æ–∫–µ–Ω—ã –≤ —Å—Å—ã–ª–∫–∞—Ö –≤–º–µ—Å—Ç–æ 6-–∑–Ω–∞—á–Ω—ã—Ö –∫–æ–¥–æ–≤
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
- [x] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
- [x] Dev —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

**üéâ –í—Å—ë –≥–æ—Ç–æ–≤–æ! –ú–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.**

Dev —Å–µ—Ä–≤–µ—Ä: http://localhost:3000
–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: http://localhost:3000/register
